name: Download and Release OpenJDK

on:
  workflow_dispatch:
    inputs:
      jdk_version:
        description: 'JDK version (11, 17, or 21)'
        required: true
        default: '17'
      platforms:
        description: 'Comma-separated list of platforms (linux/amd64, linux/arm64, windows/amd64)'
        required: true
        default: 'linux/amd64, linux/arm64, windows/amd64'

jobs:
  build:
    runs-on: ${{ matrix.runner }}
    strategy:
      matrix:
        include:
          - platform: linux/amd64
            runner: ubuntu-latest
            archive: tar.gz
            arch: x64
            download_url: https://api.adoptium.net/v3/binary/latest/${{ github.event.inputs.jdk_version }}/ga/linux/x64/jdk/hotspot/normal/adoptium
          - platform: linux/arm64
            runner: ubuntu-latest
            archive: tar.gz
            arch: aarch64
            download_url: https://api.adoptium.net/v3/binary/latest/${{ github.event.inputs.jdk_version }}/ga/linux/aarch64/jdk/hotspot/normal/adoptium
          - platform: windows/amd64
            runner: windows-latest
            archive: zip
            arch: x64
            download_url: https://api.adoptium.net/v3/binary/latest/${{ github.event.inputs.jdk_version }}/ga/windows/x64/jdk/hotspot/normal/adoptium
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up JDK (boot JDK)
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '17'
          architecture: ${{ matrix.arch }}

      - name: Download JDK Binary from Adoptium
        run: |
          echo "Downloading OpenJDK version ${{ inputs.jdk_version }} for platform ${{ matrix.platform }}"
          curl -L ${{ matrix.download_url }} -o openjdk.tar.gz

      - name: Extract OpenJDK Binary
        run: |
          mkdir -p $GITHUB_WORKSPACE/openjdk
          if [[ "${{ matrix.archive }}" == "tar.gz" ]]; then
            tar -xzf openjdk.tar.gz -C $GITHUB_WORKSPACE/openjdk
          else
            unzip openjdk.zip -d $GITHUB_WORKSPACE/openjdk
          fi

      - name: Package JDK (Tar/Gz or Zip)
        run: |
          if [[ "${{ matrix.archive }}" == "tar.gz" ]]; then
            tar -czf $GITHUB_WORKSPACE/output/openjdk-${{ inputs.jdk_version }}-${{ matrix.platform }}.tar.gz -C $GITHUB_WORKSPACE openjdk
          else
            zip -r $GITHUB_WORKSPACE/output/openjdk-${{ inputs.jdk_version }}-${{ matrix.platform }}.zip $GITHUB_WORKSPACE/openjdk
          fi

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: openjdk-${{ inputs.jdk_version }}-${{ matrix.platform }}
          path: $GITHUB_WORKSPACE/output/*
